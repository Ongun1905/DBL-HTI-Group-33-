{% extends "homepage/layout.html" %}

{% load filters %}

{% block title %}
Visualization 2 | DBL Group 33
{% endblock %}

{% block nav %}
{% include "homepage/navbar.html" with active_page='vis2' %}
{% endblock %}

{% block div %}
<div class="container">
    <div class="main">
        <h1>Visualization 2: Adjacency matrix</h1>
        <p>This visualization displays an adjacency matrix of the input data. Interestingly enough, we see that quite a lot of people emailed themselves, possibly to share files since cloud services didn't exist during the time that this data originates from.</p>
        <br />
        <h3>Controls</h3>
        <form>
            <div class="field">
                <p class="title">Matrix size</p>
                <input type="range" id="am-size-slider" class="range-slider" value="6" min="2" max="10" step="2" />
            </div>
            <div class="field">
                <p class="title">Display names</p>
                <label class="switch">
                    <input type="checkbox" id="am-toggle-names" checked>
                    <span class="switch-slider"></span>
                </label>
            </div>
        </form>

        <table class="adjacency-matrix names" id="adjacency-matrix">
            <thead class="visible">
                <tr>
                    <th><span>x</span></th>
                    {% for nodeDataTopHeader in nodeData %}
                    <th><span>{{ nodeDataTopHeader.id }}</span></th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for matrixRow, normMatrixRow, nodeDataLeftHeader in zippedMatrixData %}
                <tr>
                    <th class="visible">{{ nodeDataLeftHeader.id  }}</th>
                    {% for matrixCell in matrixRow %}
                        <td class="size-6 matrix-data-element" style="background-color: rgba(101, 204, 169, {{ normMatrixRow|index:forloop.counter0 }})">
                            {% if matrixCell > 0 %}
                            {{ matrixCell }}
                            {% endif %}
                        </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <script>
    // Get the slider and table elements
    const adjacencyMatrix = document.getElementById('adjacency-matrix')
    const topHeader = document.querySelector('.adjacency-matrix thead')
    const topHeaderElements = document.querySelectorAll('.adjacency-matrix thead th:not(:first-child)')
    const leftHeaderElements = document.querySelectorAll('.adjacency-matrix tbody th')
    const toggleNamesElement = document.getElementById('am-toggle-names')

    const sizeSlider = document.getElementById('am-size-slider')
    const matrixTableEntries = document.querySelectorAll('.adjacency-matrix .matrix-data-element')

    // When the slider value changes, resize all td elements by setting their class
    //
    // Example:
    // Let's say the slider has got the value 4. This results in every td element getting the class="size-4"
    // In CSS, all elements with the class "size-4" get a width of 4px and a height of 4px
    sizeSlider.addEventListener('change', () => {
        matrixTableEntries.forEach(entry => {
            entry.className = `size-${sizeSlider.value}`
        })
    })

    toggleNamesElement.addEventListener('click', () => {
        // Toggle the names to become visible
        if (toggleNamesElement.checked) {
            // Fix AM styling
            if (!adjacencyMatrix.classList.contains('names')) adjacencyMatrix.classList.add('names')

            // Add the names
            if (!topHeader.classList.contains('visible')) topHeader.classList.add('visible')
            leftHeaderElements.forEach(el => {
                if (!el.classList.contains('visible')) el.classList.add('visible')
            })
        } else {
            // Fix AM styling
            if (adjacencyMatrix.classList.contains('names')) adjacencyMatrix.classList.remove('names')

            // Remove the names
            if (topHeader.classList.contains('visible')) topHeader.classList.remove('visible')
            leftHeaderElements.forEach(el => {
                if (el.classList.contains('visible')) el.classList.remove('visible')
            })
        }
    })


    // Click interaction
    matrixTableEntries.forEach(entry => {
        entry.addEventListener('click', () => {
            alert('The click interaction is not yet set up!')
        })
    })

    
    </script>
</div>
{% endblock %}